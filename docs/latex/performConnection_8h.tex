\hypertarget{performConnection_8h}{}\doxysection{perform\+Connection.\+h File Reference}
\label{performConnection_8h}\index{performConnection.h@{performConnection.h}}


Function to setup connection to Game Server.  


{\ttfamily \#include $<$stdbool.\+h$>$}\newline
{\ttfamily \#include \char`\"{}info\+Structs.\+h\char`\"{}}\newline
{\ttfamily \#include \char`\"{}modules/share\+Memory.\+h\char`\"{}}\newline
{\ttfamily \#include \char`\"{}modules/utils.\+h\char`\"{}}\newline
{\ttfamily \#include \char`\"{}modules/log.\+h\char`\"{}}\newline
{\ttfamily \#include \char`\"{}modules/protocol\+Utils.\+h\char`\"{}}\newline
\doxysubsection*{Macros}
\begin{DoxyCompactItemize}
\item 
\mbox{\Hypertarget{performConnection_8h_a643dffcd3e583a234fef86b99ffcfd8b}\label{performConnection_8h_a643dffcd3e583a234fef86b99ffcfd8b}} 
\#define {\bfseries GAME\+\_\+\+ID\+\_\+\+SIZE}~13
\item 
\mbox{\Hypertarget{performConnection_8h_a3be17654a3af5b6a62da85bf94788e33}\label{performConnection_8h_a3be17654a3af5b6a62da85bf94788e33}} 
\#define {\bfseries PORTNUMBER}~1357
\item 
\mbox{\Hypertarget{performConnection_8h_a63ebf0552e7b4b8f37af87147904ffce}\label{performConnection_8h_a63ebf0552e7b4b8f37af87147904ffce}} 
\#define {\bfseries HOSTNAME}~\char`\"{}sysprak.\+priv.\+lab.\+nm.\+ifi.\+lmu.\+de\char`\"{}
\item 
\mbox{\Hypertarget{performConnection_8h_ad6d856f27e33f0b1defa5cbca6e41e5d}\label{performConnection_8h_ad6d856f27e33f0b1defa5cbca6e41e5d}} 
\#define {\bfseries GAMEKINDNAME}~\char`\"{}Bashni\char`\"{}
\item 
\mbox{\Hypertarget{performConnection_8h_aa7a1b41e75d8bbc5ea15ada480983419}\label{performConnection_8h_aa7a1b41e75d8bbc5ea15ada480983419}} 
\#define {\bfseries CLIENT\+\_\+\+VERSION}~\char`\"{}2.\+42\char`\"{}
\end{DoxyCompactItemize}
\doxysubsection*{Functions}
\begin{DoxyCompactItemize}
\item 
void \mbox{\hyperlink{performConnection_8h_a810e48631ff65df542158a0c7bfbca53}{perform\+Connection}} (int sock, config\+\_\+t $\ast$config)
\begin{DoxyCompactList}\small\item\em implements prolog phase using passed Opt. \end{DoxyCompactList}\item 
\mbox{\hyperlink{structGameInfo}{game\+\_\+info}} $\ast$ \mbox{\hyperlink{performConnection_8h_a3422bd40d37dcdb1b25b25ec3567d64f}{get\+Game\+Info}} ()
\begin{DoxyCompactList}\small\item\em getter for game\+\_\+info struct. \end{DoxyCompactList}\item 
void \mbox{\hyperlink{performConnection_8h_a6f72486ea2f588d520bfd79abf1c3e57}{free\+Game\+Info}} (\mbox{\hyperlink{structGameInfo}{game\+\_\+info}} $\ast$game\+Info)
\begin{DoxyCompactList}\small\item\em frees memory allocated before. \end{DoxyCompactList}\end{DoxyCompactItemize}


\doxysubsection{Detailed Description}
Function to setup connection to Game Server. 

This function implements the prolog phase of the protocol and parse the server response. It also contains a function for pretty printing.

\begin{DoxyAuthor}{Author}
Erik Kellenter 
\end{DoxyAuthor}
\begin{DoxyRefDesc}{Bug}
\item[\mbox{\hyperlink{bug__bug000001}{Bug}}]recv\+Command throws error when server sends 48 bytes after PLAYER COMMAND. \end{DoxyRefDesc}


\doxysubsection{Function Documentation}
\mbox{\Hypertarget{performConnection_8h_a6f72486ea2f588d520bfd79abf1c3e57}\label{performConnection_8h_a6f72486ea2f588d520bfd79abf1c3e57}} 
\index{performConnection.h@{performConnection.h}!freeGameInfo@{freeGameInfo}}
\index{freeGameInfo@{freeGameInfo}!performConnection.h@{performConnection.h}}
\doxysubsubsection{\texorpdfstring{freeGameInfo()}{freeGameInfo()}}
{\footnotesize\ttfamily void free\+Game\+Info (\begin{DoxyParamCaption}\item[{\mbox{\hyperlink{structGameInfo}{game\+\_\+info}} $\ast$}]{game\+Info }\end{DoxyParamCaption})}



frees memory allocated before. 


\begin{DoxyParams}{Parameters}
{\em game\+Info} & game\+\_\+info struct that has been used before \\
\hline
\end{DoxyParams}


Definition at line 130 of file perform\+Connection.\+c.


\begin{DoxyCode}{0}
\DoxyCodeLine{130                                        \{}
\DoxyCodeLine{131   \textcolor{keywordflow}{if} (gameInfo != NULL) \{}
\DoxyCodeLine{132     free(gameInfo-\/>raw);}
\DoxyCodeLine{133     \textcolor{keywordflow}{for} (\textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int} i = 0; i < gameInfo-\/>total; i++) \{}
\DoxyCodeLine{134       free(gameInfo-\/>playerList[i]);}
\DoxyCodeLine{135     \}}
\DoxyCodeLine{136     free(gameInfo-\/>playerList);}
\DoxyCodeLine{137   \}}
\DoxyCodeLine{138 \}}

\end{DoxyCode}
\mbox{\Hypertarget{performConnection_8h_a3422bd40d37dcdb1b25b25ec3567d64f}\label{performConnection_8h_a3422bd40d37dcdb1b25b25ec3567d64f}} 
\index{performConnection.h@{performConnection.h}!getGameInfo@{getGameInfo}}
\index{getGameInfo@{getGameInfo}!performConnection.h@{performConnection.h}}
\doxysubsubsection{\texorpdfstring{getGameInfo()}{getGameInfo()}}
{\footnotesize\ttfamily \mbox{\hyperlink{structGameInfo}{game\+\_\+info}}$\ast$ get\+Game\+Info (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption})}



getter for game\+\_\+info struct. 

To avoid memory leaks, call free\+Game\+Info afterwards.

\begin{DoxyReturn}{Returns}
game\+\_\+info struct 
\end{DoxyReturn}


Definition at line 128 of file perform\+Connection.\+c.


\begin{DoxyCode}{0}
\DoxyCodeLine{128 \{ \textcolor{keywordflow}{return} parseCommand(NULL, RETURN); \}}

\end{DoxyCode}
\mbox{\Hypertarget{performConnection_8h_a810e48631ff65df542158a0c7bfbca53}\label{performConnection_8h_a810e48631ff65df542158a0c7bfbca53}} 
\index{performConnection.h@{performConnection.h}!performConnection@{performConnection}}
\index{performConnection@{performConnection}!performConnection.h@{performConnection.h}}
\doxysubsubsection{\texorpdfstring{performConnection()}{performConnection()}}
{\footnotesize\ttfamily void perform\+Connection (\begin{DoxyParamCaption}\item[{int}]{sock,  }\item[{config\+\_\+t $\ast$}]{config }\end{DoxyParamCaption})}



implements prolog phase using passed Opt. 


\begin{DoxyParams}{Parameters}
{\em sock} & socket to connect with \\
\hline
{\em config} & options used for the connection \\
\hline
\end{DoxyParams}


Definition at line 192 of file perform\+Connection.\+c.


\begin{DoxyCode}{0}
\DoxyCodeLine{192                                                    \{}
\DoxyCodeLine{193   \textcolor{keywordtype}{int} size = 0;}
\DoxyCodeLine{194   p = config-\/>f;}
\DoxyCodeLine{195   \textcolor{keywordflow}{if} (config-\/>game == NULL || config-\/>host == NULL || config-\/>port == 0) \{}
\DoxyCodeLine{196     log\_info(\textcolor{stringliteral}{"{}Using Default Settings"{}});}
\DoxyCodeLine{197     \textcolor{keywordflow}{if} (setupConnection(sock) != 0) \{}
\DoxyCodeLine{198       freeConfig(config);}
\DoxyCodeLine{199       exit(EXIT\_FAILURE);}
\DoxyCodeLine{200     \}}
\DoxyCodeLine{201   \} \textcolor{keywordflow}{else} \{}
\DoxyCodeLine{202     log\_info(\textcolor{stringliteral}{"{}Using Config Settings"{}});}
\DoxyCodeLine{203     printfConfig(config);}
\DoxyCodeLine{204     \textcolor{keywordflow}{if} (setupConnectionByStruct(sock, config) != 0) \{}
\DoxyCodeLine{205       freeConfig(config);}
\DoxyCodeLine{206       exit(EXIT\_FAILURE);}
\DoxyCodeLine{207     \}}
\DoxyCodeLine{208     freeConfig(config);}
\DoxyCodeLine{209   \}}
\DoxyCodeLine{210 }
\DoxyCodeLine{211   \textcolor{keywordtype}{void} *recvBuff;}
\DoxyCodeLine{212   recvBuff = recvCommand(sock, 1, \&size); \textcolor{comment}{// + MNM Gameserver <<Gameserver}}
\DoxyCodeLine{213                                           \textcolor{comment}{// Version>> accepting connections}}
\DoxyCodeLine{214   parseCommand(recvBuff, START);}
\DoxyCodeLine{215   free(recvBuff);}
\DoxyCodeLine{216 }
\DoxyCodeLine{217   sendCommand(sock, VERSION, CLIENT\_VERSION);}
\DoxyCodeLine{218 }
\DoxyCodeLine{219   recvBuff = recvCommand(}
\DoxyCodeLine{220       sock, 1,}
\DoxyCodeLine{221       \&size); \textcolor{comment}{// + Client version accepted -\/ please send Game-\/ID to join}}
\DoxyCodeLine{222   parseCommand(recvBuff, VERSION);}
\DoxyCodeLine{223   free(recvBuff);}
\DoxyCodeLine{224 }
\DoxyCodeLine{225   sendCommand(sock, ID, config-\/>gameId);}
\DoxyCodeLine{226 }
\DoxyCodeLine{227   recvBuff = recvCommand(}
\DoxyCodeLine{228       sock, 2, \&size); \textcolor{comment}{// + PLAYING <<Gamekind-\/Name>>\(\backslash\)n + <<Game-\/Name>>}}
\DoxyCodeLine{229 }
\DoxyCodeLine{230   parseCommand(recvBuff, ID);}
\DoxyCodeLine{231   free(recvBuff);}
\DoxyCodeLine{232 }
\DoxyCodeLine{233   \textcolor{comment}{// retry without player id later}}
\DoxyCodeLine{234   sendCommand(sock, PLAYER, config-\/>playerId);}
\DoxyCodeLine{235 }
\DoxyCodeLine{236   recvBuff = recvCommand(sock, 0, \&size); \textcolor{comment}{//}}
\DoxyCodeLine{237   parseCommand(recvBuff, PLAYER);}
\DoxyCodeLine{238   free(recvBuff);}
\DoxyCodeLine{239 }
\DoxyCodeLine{240   printProlog(\mbox{\hyperlink{performConnection_8h_a3422bd40d37dcdb1b25b25ec3567d64f}{getGameInfo}}());}
\DoxyCodeLine{241 \}}

\end{DoxyCode}
