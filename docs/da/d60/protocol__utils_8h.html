<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.1"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>&#x202A;Baschni: &#x202A;modules/protocol_utils.h File Reference</title>
<link href="../../tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../jquery.js"></script>
<script type="text/javascript" src="../../dynsections.js"></script>
<link href="../../search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../search/searchdata.js"></script>
<script type="text/javascript" src="../../search/search.js"></script>
<link href="../../doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">&#x202A;Baschni
   &#160;<span id="projectnumber">0.1</span>
   </div>
   <div id="projectbrief">&#x202A;Bashni (Russian: ба́шни, towers), also known as column draughts, multi-level checkers, and rarer Chinese checkers.</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.1 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "../../search",false,'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="../../menudata.js"></script>
<script type="text/javascript" src="../../menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('../../',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="../../dir_e05d7e2b1ecd646af5bb94391405f3b5.html">&#x202A;modules</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="summary">
<a href="#typedef-members">Typedefs</a> &#124;
<a href="#enum-members">Enumerations</a> &#124;
<a href="#func-members">Functions</a>  </div>
  <div class="headertitle">
<div class="title">protocol_utils.h File Reference</div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><code>#include &quot;log.h&quot;</code><br />
</div>
<p><a href="../../da/d60/protocol__utils_8h_source.html">Go to the source code of this file.</a></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="typedef-members"></a>
Typedefs</h2></td></tr>
<tr class="memitem:acaf07f4bb9dc8f6fe8a2328ab9ca58a1"><td class="memItemLeft" align="right" valign="top"><a id="acaf07f4bb9dc8f6fe8a2328ab9ca58a1"></a>
typedef enum <a class="el" href="../../da/d60/protocol__utils_8h.html#a0fbada5bff0eeb4dc6be4b6e6f1c4eaf">COMMAND</a>&#160;</td><td class="memItemRight" valign="bottom"><b>COMMAND</b></td></tr>
<tr class="separator:acaf07f4bb9dc8f6fe8a2328ab9ca58a1"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="enum-members"></a>
Enumerations</h2></td></tr>
<tr class="memitem:a0fbada5bff0eeb4dc6be4b6e6f1c4eaf"><td class="memItemLeft" align="right" valign="top">enum &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../da/d60/protocol__utils_8h.html#a0fbada5bff0eeb4dc6be4b6e6f1c4eaf">COMMAND</a> { <br />
&#160;&#160;<b>RETURN</b>
, <b>START</b>
, <b>VERSION</b>
, <b>ID</b>
, <br />
&#160;&#160;<b>PLAYER</b>
, <b>THINKING</b>
, <b>OKWAIT</b>
, <b>PLAY</b>
<br />
 }</td></tr>
<tr class="memdesc:a0fbada5bff0eeb4dc6be4b6e6f1c4eaf"><td class="mdescLeft">&#160;</td><td class="mdescRight">&#x202A;COMMAND enum.  <a href="../../da/d60/protocol__utils_8h.html#a0fbada5bff0eeb4dc6be4b6e6f1c4eaf">More...</a><br /></td></tr>
<tr class="separator:a0fbada5bff0eeb4dc6be4b6e6f1c4eaf"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:a8bb25da1ecc90488a9a8f22d0d6a8d4c"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../da/d60/protocol__utils_8h.html#a8bb25da1ecc90488a9a8f22d0d6a8d4c">sendCommand</a> (int sock, <a class="el" href="../../da/d60/protocol__utils_8h.html#a0fbada5bff0eeb4dc6be4b6e6f1c4eaf">COMMAND</a> c, char *value)</td></tr>
<tr class="memdesc:a8bb25da1ecc90488a9a8f22d0d6a8d4c"><td class="mdescLeft">&#160;</td><td class="mdescRight">&#x202A;Sends command to server.  <a href="../../da/d60/protocol__utils_8h.html#a8bb25da1ecc90488a9a8f22d0d6a8d4c">More...</a><br /></td></tr>
<tr class="separator:a8bb25da1ecc90488a9a8f22d0d6a8d4c"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ad1420fe426c4a653b336e132c00510e7"><td class="memItemLeft" align="right" valign="top">void *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../da/d60/protocol__utils_8h.html#ad1420fe426c4a653b336e132c00510e7">recvCommand</a> (int sock, int lines, int *size)</td></tr>
<tr class="memdesc:ad1420fe426c4a653b336e132c00510e7"><td class="mdescLeft">&#160;</td><td class="mdescRight">&#x202A;Receives server response after sending a command.  <a href="../../da/d60/protocol__utils_8h.html#ad1420fe426c4a653b336e132c00510e7">More...</a><br /></td></tr>
<tr class="separator:ad1420fe426c4a653b336e132c00510e7"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p class="DocNodeLTR">protocol utilities</p>
<dl class="section author DocNodeLTR"><dt>Author</dt><dd>&#x202A;Erik </dd></dl>
<dl class="bug DocNodeLTR"><dt><b><a class="el" href="../../de/da5/bug.html#_bug000006">Bug:</a></b></dt><dd>&#x202A;not known </dd></dl>

<p class="definition">Definition in file <a class="el" href="../../da/d60/protocol__utils_8h_source.html">protocol_utils.h</a>.</p>
</div><h2 class="groupheader">Enumeration Type Documentation</h2>
<a id="a0fbada5bff0eeb4dc6be4b6e6f1c4eaf"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a0fbada5bff0eeb4dc6be4b6e6f1c4eaf">&#9670;&nbsp;</a></span>COMMAND</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">enum <a class="el" href="../../da/d60/protocol__utils_8h.html#a0fbada5bff0eeb4dc6be4b6e6f1c4eaf">COMMAND</a></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>&#x202A;COMMAND enum. </p>
<p class="DocNodeLTR">Contains all relevant commands for following functions. </p>

<p class="definition">Definition at line <a class="el" href="../../da/d60/protocol__utils_8h_source.html#l00019">19</a> of file <a class="el" href="../../da/d60/protocol__utils_8h_source.html">protocol_utils.h</a>.</p>
<div class="fragment"><div class="line"><a name="l00019"></a><span class="lineno">   19</span>&#160;                     {</div>
<div class="line"><a name="l00020"></a><span class="lineno">   20</span>&#160;  RETURN,</div>
<div class="line"><a name="l00021"></a><span class="lineno">   21</span>&#160;  START,</div>
<div class="line"><a name="l00022"></a><span class="lineno">   22</span>&#160;  VERSION,</div>
<div class="line"><a name="l00023"></a><span class="lineno">   23</span>&#160;  ID,</div>
<div class="line"><a name="l00024"></a><span class="lineno">   24</span>&#160;  PLAYER,</div>
<div class="line"><a name="l00025"></a><span class="lineno">   25</span>&#160;  THINKING,</div>
<div class="line"><a name="l00026"></a><span class="lineno">   26</span>&#160;  OKWAIT,</div>
<div class="line"><a name="l00027"></a><span class="lineno">   27</span>&#160;  PLAY</div>
<div class="line"><a name="l00028"></a><span class="lineno">   28</span>&#160;} <a class="code" href="../../da/d60/protocol__utils_8h.html#a0fbada5bff0eeb4dc6be4b6e6f1c4eaf">COMMAND</a>;</div>
<div class="ttc" id="aprotocol__utils_8h_html_a0fbada5bff0eeb4dc6be4b6e6f1c4eaf"><div class="ttname"><a href="../../da/d60/protocol__utils_8h.html#a0fbada5bff0eeb4dc6be4b6e6f1c4eaf">COMMAND</a></div><div class="ttdeci">COMMAND</div><div class="ttdoc">COMMAND enum.</div><div class="ttdef"><b>Definition:</b> <a href="../../da/d60/protocol__utils_8h_source.html#l00019">protocol_utils.h:19</a></div></div>
</div><!-- fragment -->
</div>
</div>
<h2 class="groupheader">Function Documentation</h2>
<a id="ad1420fe426c4a653b336e132c00510e7"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ad1420fe426c4a653b336e132c00510e7">&#9670;&nbsp;</a></span>recvCommand()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void* recvCommand </td>
          <td>(</td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>sock</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>lines</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int *&#160;</td>
          <td class="paramname"><em>size</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>&#x202A;Receives server response after sending a command. </p>
<p class="DocNodeLTR">The function receives the number of lines passed as parameter. If lines is 0, then the function waits until an END command (e. g. ENDPLAYERS or ENDPIECELIST) is received. It returns a pointer to a dynamically allocated memory that must be freed.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">sock</td><td>&#x202A;socket file descriptor </td></tr>
    <tr><td class="paramname">lines</td><td>&#x202A;expected lines the server will send </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>&#x202A;pointer to received data </dd></dl>

<p class="definition">Definition at line <a class="el" href="../../d3/d7d/protocol__utils_8c_source.html#l00070">70</a> of file <a class="el" href="../../d3/d7d/protocol__utils_8c_source.html">protocol_utils.c</a>.</p>
<div class="fragment"><div class="line"><a name="l00070"></a><span class="lineno">   70</span>&#160;                                                  {</div>
<div class="line"><a name="l00071"></a><span class="lineno">   71</span>&#160;  <span class="keyword">static</span> <span class="keywordtype">char</span> buffer[RECV_BUFF_SIZE];</div>
<div class="line"><a name="l00072"></a><span class="lineno">   72</span>&#160;  <span class="comment">//printf(&quot;Current cmd buffer: %s\n&quot;, buffer);</span></div>
<div class="line"><a name="l00073"></a><span class="lineno">   73</span>&#160;  ssize_t totalBytes = 0; <span class="comment">// number of bytes in buff</span></div>
<div class="line"><a name="l00074"></a><span class="lineno">   74</span>&#160;  <span class="keywordtype">int</span> blockCount = 2;</div>
<div class="line"><a name="l00075"></a><span class="lineno">   75</span>&#160;  <span class="keywordtype">char</span> *recvBuff = malloc(</div>
<div class="line"><a name="l00076"></a><span class="lineno">   76</span>&#160;      blockCount * RECV_BUFF_SIZE); <span class="comment">// initializing 2 memory blocks, so if one</span></div>
<div class="line"><a name="l00077"></a><span class="lineno">   77</span>&#160;                                    <span class="comment">// fills up the next one can just be used</span></div>
<div class="line"><a name="l00078"></a><span class="lineno">   78</span>&#160;  <span class="comment">// fills up recvBuff with oddments from last call</span></div>
<div class="line"><a name="l00079"></a><span class="lineno">   79</span>&#160;  *size = blockCount * RECV_BUFF_SIZE;</div>
<div class="line"><a name="l00080"></a><span class="lineno">   80</span>&#160;  <span class="keywordtype">int</span> lineCount = lines == 0 ? INT_MAX : lines;</div>
<div class="line"><a name="l00081"></a><span class="lineno">   81</span>&#160;  <span class="keywordtype">char</span> *pos;</div>
<div class="line"><a name="l00082"></a><span class="lineno">   82</span>&#160;  <span class="keywordflow">while</span> ((pos = strchr(buffer, <span class="charliteral">&#39;\n&#39;</span>)) != NULL &amp;&amp; lineCount &gt; 0) {</div>
<div class="line"><a name="l00083"></a><span class="lineno">   83</span>&#160;    <span class="keywordtype">size_t</span> bytes = pos - buffer;</div>
<div class="line"><a name="l00084"></a><span class="lineno">   84</span>&#160;    bytes++;</div>
<div class="line"><a name="l00085"></a><span class="lineno">   85</span>&#160;    strncpy(recvBuff + totalBytes, buffer, bytes);</div>
<div class="line"><a name="l00086"></a><span class="lineno">   86</span>&#160;    totalBytes += bytes;</div>
<div class="line"><a name="l00087"></a><span class="lineno">   87</span>&#160;    recvBuff[totalBytes] = <span class="charliteral">&#39;\0&#39;</span>;</div>
<div class="line"><a name="l00088"></a><span class="lineno">   88</span>&#160;    lineCount--;</div>
<div class="line"><a name="l00089"></a><span class="lineno">   89</span>&#160;    <span class="keywordtype">size_t</span> len = strlen(pos + 1);</div>
<div class="line"><a name="l00090"></a><span class="lineno">   90</span>&#160;    memmove(buffer, pos + 1, len);</div>
<div class="line"><a name="l00091"></a><span class="lineno">   91</span>&#160;    buffer[len] = <span class="charliteral">&#39;\0&#39;</span>;</div>
<div class="line"><a name="l00092"></a><span class="lineno">   92</span>&#160;  }</div>
<div class="line"><a name="l00093"></a><span class="lineno">   93</span>&#160; </div>
<div class="line"><a name="l00094"></a><span class="lineno">   94</span>&#160;  <span class="keywordflow">if</span> (lineCount &gt; 0) {</div>
<div class="line"><a name="l00095"></a><span class="lineno">   95</span>&#160;    strcpy(recvBuff + totalBytes, buffer);</div>
<div class="line"><a name="l00096"></a><span class="lineno">   96</span>&#160;    totalBytes += strlen(buffer);</div>
<div class="line"><a name="l00097"></a><span class="lineno">   97</span>&#160;    memset(buffer, 0, RECV_BUFF_SIZE);</div>
<div class="line"><a name="l00098"></a><span class="lineno">   98</span>&#160;  }</div>
<div class="line"><a name="l00099"></a><span class="lineno">   99</span>&#160; </div>
<div class="line"><a name="l00100"></a><span class="lineno">  100</span>&#160;  <span class="keywordflow">while</span> (lineCount &gt; 0) {</div>
<div class="line"><a name="l00101"></a><span class="lineno">  101</span>&#160;    ssize_t receivedBytes;</div>
<div class="line"><a name="l00102"></a><span class="lineno">  102</span>&#160;    <span class="keywordflow">switch</span> ((receivedBytes =</div>
<div class="line"><a name="l00103"></a><span class="lineno">  103</span>&#160;                 recv(sock, recvBuff + totalBytes, RECV_BUFF_SIZE - 1, 0))) {</div>
<div class="line"><a name="l00104"></a><span class="lineno">  104</span>&#160;    <span class="keywordflow">case</span> -1:</div>
<div class="line"><a name="l00105"></a><span class="lineno">  105</span>&#160;      perror(<span class="stringliteral">&quot;receive error&quot;</span>);</div>
<div class="line"><a name="l00106"></a><span class="lineno">  106</span>&#160;      free(recvBuff);</div>
<div class="line"><a name="l00107"></a><span class="lineno">  107</span>&#160;      exit(EXIT_FAILURE);</div>
<div class="line"><a name="l00108"></a><span class="lineno">  108</span>&#160;    <span class="keywordflow">case</span> 0:</div>
<div class="line"><a name="l00109"></a><span class="lineno">  109</span>&#160;      log_error(<span class="stringliteral">&quot;connection closed by server&quot;</span>);</div>
<div class="line"><a name="l00110"></a><span class="lineno">  110</span>&#160;      log_error(<span class="stringliteral">&quot;already received: %s&quot;</span>, recvBuff);</div>
<div class="line"><a name="l00111"></a><span class="lineno">  111</span>&#160;      free(recvBuff);</div>
<div class="line"><a name="l00112"></a><span class="lineno">  112</span>&#160;      exit(EXIT_FAILURE);</div>
<div class="line"><a name="l00113"></a><span class="lineno">  113</span>&#160;    <span class="keywordflow">default</span>:</div>
<div class="line"><a name="l00114"></a><span class="lineno">  114</span>&#160;      <span class="keywordflow">if</span> (recvBuff[0] == <span class="charliteral">&#39;-&#39;</span>) {</div>
<div class="line"><a name="l00115"></a><span class="lineno">  115</span>&#160;        recvBuff[totalBytes] = <span class="charliteral">&#39;\0&#39;</span>;</div>
<div class="line"><a name="l00116"></a><span class="lineno">  116</span>&#160;        log_error(<span class="stringliteral">&quot;%s&quot;</span>, recvBuff);</div>
<div class="line"><a name="l00117"></a><span class="lineno">  117</span>&#160;        free(recvBuff);</div>
<div class="line"><a name="l00118"></a><span class="lineno">  118</span>&#160;        exit(EXIT_FAILURE);</div>
<div class="line"><a name="l00119"></a><span class="lineno">  119</span>&#160;      }</div>
<div class="line"><a name="l00120"></a><span class="lineno">  120</span>&#160;      <span class="keywordtype">int</span> bytes = 0;</div>
<div class="line"><a name="l00121"></a><span class="lineno">  121</span>&#160;      <span class="keywordflow">while</span> (bytes &lt; receivedBytes &amp;&amp; lineCount &gt; 0) {</div>
<div class="line"><a name="l00122"></a><span class="lineno">  122</span>&#160;        <span class="keywordflow">if</span> (recvBuff[totalBytes + bytes] == <span class="charliteral">&#39;\n&#39;</span>) {</div>
<div class="line"><a name="l00123"></a><span class="lineno">  123</span>&#160;          lineCount--;</div>
<div class="line"><a name="l00124"></a><span class="lineno">  124</span>&#160;        }</div>
<div class="line"><a name="l00125"></a><span class="lineno">  125</span>&#160;        bytes++;</div>
<div class="line"><a name="l00126"></a><span class="lineno">  126</span>&#160;      }</div>
<div class="line"><a name="l00127"></a><span class="lineno">  127</span>&#160;      <span class="keywordflow">if</span> (bytes &lt; receivedBytes) {</div>
<div class="line"><a name="l00128"></a><span class="lineno">  128</span>&#160;        recvBuff[totalBytes + receivedBytes] = <span class="charliteral">&#39;\0&#39;</span>;</div>
<div class="line"><a name="l00129"></a><span class="lineno">  129</span>&#160;        strcpy(buffer, recvBuff + totalBytes + bytes);</div>
<div class="line"><a name="l00130"></a><span class="lineno">  130</span>&#160;      }</div>
<div class="line"><a name="l00131"></a><span class="lineno">  131</span>&#160;      totalBytes +=</div>
<div class="line"><a name="l00132"></a><span class="lineno">  132</span>&#160;          bytes; <span class="comment">// increment returned bytes every loop (at least 1 byte)</span></div>
<div class="line"><a name="l00133"></a><span class="lineno">  133</span>&#160;      recvBuff[totalBytes] = <span class="charliteral">&#39;\0&#39;</span>;</div>
<div class="line"><a name="l00134"></a><span class="lineno">  134</span>&#160;      <span class="keywordtype">char</span> *end;</div>
<div class="line"><a name="l00135"></a><span class="lineno">  135</span>&#160;      <span class="keywordflow">if</span> (lineCount &gt; lines &amp;&amp; (end = strstr(recvBuff, <span class="stringliteral">&quot;END&quot;</span>)) != NULL &amp;&amp; (end = strchr(end, <span class="charliteral">&#39;\n&#39;</span>)) != NULL) {</div>
<div class="line"><a name="l00136"></a><span class="lineno">  136</span>&#160;        strcpy(buffer,</div>
<div class="line"><a name="l00137"></a><span class="lineno">  137</span>&#160;               end + 1); <span class="comment">// splitted string size is less than RECV_BUFF_SIZe</span></div>
<div class="line"><a name="l00138"></a><span class="lineno">  138</span>&#160;        end[1] = <span class="charliteral">&#39;\0&#39;</span>;</div>
<div class="line"><a name="l00139"></a><span class="lineno">  139</span>&#160;        lineCount = 0;</div>
<div class="line"><a name="l00140"></a><span class="lineno">  140</span>&#160;      } <span class="keywordflow">else</span> <span class="keywordflow">if</span> ((blockCount * RECV_BUFF_SIZE) - totalBytes &lt; RECV_BUFF_SIZE) {</div>
<div class="line"><a name="l00141"></a><span class="lineno">  141</span>&#160;        recvBuff = realloc(recvBuff,</div>
<div class="line"><a name="l00142"></a><span class="lineno">  142</span>&#160;                           ++blockCount * RECV_BUFF_SIZE); <span class="comment">// no error handling</span></div>
<div class="line"><a name="l00143"></a><span class="lineno">  143</span>&#160;        *size = blockCount * RECV_BUFF_SIZE;</div>
<div class="line"><a name="l00144"></a><span class="lineno">  144</span>&#160;      }</div>
<div class="line"><a name="l00145"></a><span class="lineno">  145</span>&#160;      <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00146"></a><span class="lineno">  146</span>&#160;    }</div>
<div class="line"><a name="l00147"></a><span class="lineno">  147</span>&#160;  }</div>
<div class="line"><a name="l00148"></a><span class="lineno">  148</span>&#160;  <span class="keywordflow">return</span> (<span class="keywordtype">void</span> *)recvBuff;</div>
<div class="line"><a name="l00149"></a><span class="lineno">  149</span>&#160;}</div>
</div><!-- fragment -->
</div>
</div>
<a id="a8bb25da1ecc90488a9a8f22d0d6a8d4c"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a8bb25da1ecc90488a9a8f22d0d6a8d4c">&#9670;&nbsp;</a></span>sendCommand()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void sendCommand </td>
          <td>(</td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>sock</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="../../da/d60/protocol__utils_8h.html#a0fbada5bff0eeb4dc6be4b6e6f1c4eaf">COMMAND</a>&#160;</td>
          <td class="paramname"><em>c</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char *&#160;</td>
          <td class="paramname"><em>value</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>&#x202A;Sends command to server. </p>
<p class="DocNodeLTR">The function parses and concatenates the command with the value passed to the function and afterwards send it to the server.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">sock</td><td>&#x202A;socket file descriptor </td></tr>
    <tr><td class="paramname">c</td><td>&#x202A;enum COMMAND </td></tr>
    <tr><td class="paramname">value</td><td>&#x202A;value that will be appended to command </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="../../d3/d7d/protocol__utils_8c_source.html#l00045">45</a> of file <a class="el" href="../../d3/d7d/protocol__utils_8c_source.html">protocol_utils.c</a>.</p>
<div class="fragment"><div class="line"><a name="l00045"></a><span class="lineno">   45</span>&#160;                                                   {</div>
<div class="line"><a name="l00046"></a><span class="lineno">   46</span>&#160;  <span class="keywordtype">char</span> sendBuff[50] = <span class="stringliteral">&quot;&quot;</span>;</div>
<div class="line"><a name="l00047"></a><span class="lineno">   47</span>&#160;  <span class="keywordtype">char</span> *command = lookup(c);</div>
<div class="line"><a name="l00048"></a><span class="lineno">   48</span>&#160;  <span class="keywordtype">size_t</span> size;</div>
<div class="line"><a name="l00049"></a><span class="lineno">   49</span>&#160;  <span class="keywordflow">if</span> (value == NULL || strlen(value) == 0) {</div>
<div class="line"><a name="l00050"></a><span class="lineno">   50</span>&#160;    size = sprintf(sendBuff, <span class="stringliteral">&quot;%s\n&quot;</span>, command);</div>
<div class="line"><a name="l00051"></a><span class="lineno">   51</span>&#160;  } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00052"></a><span class="lineno">   52</span>&#160;    size = sprintf(sendBuff, <span class="stringliteral">&quot;%s %s\n&quot;</span>, command, value);</div>
<div class="line"><a name="l00053"></a><span class="lineno">   53</span>&#160;  }</div>
<div class="line"><a name="l00054"></a><span class="lineno">   54</span>&#160;  <span class="comment">//printf(&quot;command %s, send buff %s\n&quot;, lookup(c), sendBuff);</span></div>
<div class="line"><a name="l00055"></a><span class="lineno">   55</span>&#160;  <span class="keywordflow">if</span> (send(sock, sendBuff, size, 0) &lt; 0) {</div>
<div class="line"><a name="l00056"></a><span class="lineno">   56</span>&#160;    perror(<span class="stringliteral">&quot;sending failed\n&quot;</span>);</div>
<div class="line"><a name="l00057"></a><span class="lineno">   57</span>&#160;    exit(EXIT_FAILURE);</div>
<div class="line"><a name="l00058"></a><span class="lineno">   58</span>&#160;  }</div>
<div class="line"><a name="l00059"></a><span class="lineno">   59</span>&#160;}</div>
</div><!-- fragment -->
</div>
</div>
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="../../doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.1
</small></address>
</body>
</html>
